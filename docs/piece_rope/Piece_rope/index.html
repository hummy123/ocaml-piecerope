<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Piece_rope (piece_rope.Piece_rope)</title><link rel="stylesheet" href="../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">piece_rope</a> &#x00BB; Piece_rope</nav><header class="odoc-preamble"><h1>Module <code><span>Piece_rope</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The Piece_rope.t type implements an efficient data structure for inserting, deleting and retrieving text.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span><span class="keyword">val</span> empty : <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>The empty Piece_rope.t.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-insert"><a href="#val-insert" class="anchor"></a><code><span><span class="keyword">val</span> insert : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function inserts a string into a Piece_rope.t at the specified index which is assumed to be in UTF-32. If you want to insert using UTF-8 or UTF-16 indices, use the Piece_rope.offsets function to convert the indices to UTF-32 and then use this function.</p><p>Accepts: The index to insert into, in UTF-32. The string to insert. The Piece_rope.t to insert into.</p><p>Returns: The Piece_rope.t with the node inserted at the given index.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-prepend"><a href="#val-prepend" class="anchor"></a><code><span><span class="keyword">val</span> prepend : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function inserts the given node at the very start of the Piece_rope.t.</p><p>Accepts: The string to insert. The Piece_rope.t to insert into.</p><p>Returns: The Piece_rope.t with the string prepended.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-append"><a href="#val-append" class="anchor"></a><code><span><span class="keyword">val</span> append : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function inserts the given string to the very end of the Piece_rope.t.</p><p>Accepts: The string to insert. The Piece_rope.t to insert into.</p><p>Returns: The Piece_rope.t with the node appended.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delete"><a href="#val-delete" class="anchor"></a><code><span><span class="keyword">val</span> delete : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function deletes a range, specified in UTF-32 indices, of text from the given Piece_tree. If you want to delete using UTF-8 or UTF-16 indices, use the Piece_rope.offsets function to convert the indices to UTF-32 and then use this function.</p><p>Accepts: The start index to delete from, in UTF-32. The length to delete, in UTF-32. The Piece_rope.t to delete from.</p><p>Returns: The Piece_rope.t with the given range deleted.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-substring"><a href="#val-substring" class="anchor"></a><code><span><span class="keyword">val</span> substring : <span>int <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>This function extracts a substring from the given tree, assuming start and length are UTF-32. If you would rather use UTF-8 or UTF-32 indices, use the Piece_rope.offsets function to convert the indices to UTF-32 and then use this function.</p><p>Accepts: The start index to start extracting a substring from, in UTF-32. The length to extract, in UTF-32. The Piece_rope.t to extract a substring from.</p><p>Returns: The extracted substring.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_line"><a href="#val-get_line" class="anchor"></a><code><span><span class="keyword">val</span> get_line : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.line_offset</span></span></code></div><div class="spec-doc"><p>This function retrieves a given line from a Piece_tree.</p><p>Accepts: The line to retrieve. This is zero-indexed, just like string indices are. The Piece_rope.t to retrieve the line from</p><p>Returns: A line_offset instance containing the retrieved line and the offset the line starts at.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_text"><a href="#val-get_text" class="anchor"></a><code><span><span class="keyword">val</span> get_text : <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>This function returns all the text for the given Piece_rope.t.</p><p>Accepts: The Piece_rope.t to retrieve text from.</p><p>Returns: String containing all text in the Piece_tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_string"><a href="#val-of_string" class="anchor"></a><code><span><span class="keyword">val</span> of_string : <span>string <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function creates a new Piece_rope.t from a string.</p><p>Accepts: The string to create the Piece_rope.t with.</p><p>Returns: The newly created Piece_rope.t.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stats"><a href="#val-stats" class="anchor"></a><code><span><span class="keyword">val</span> stats : 
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.tree_stats</span></span></code></div><div class="spec-doc"><p>This function returns statistics for the given Piece_rope.t. The statistics returned are:</p><ul><li>The number of lines in the Piece_rope.t.</li><li>The length of the Piece_rope.t in UTF-8, UTF-16 and UTF-32.</li></ul><p>Accepts: The Piece_tree to retrieve statistics about.</p><p>Returns: The tree_stats for the given tree.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-offsets"><a href="#val-offsets" class="anchor"></a><code><span><span class="keyword">val</span> offsets : 
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.encoding</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.index_offsets</span></span></code></div><div class="spec-doc"><p>This function, given an index, returns an index_offsets record describing the offset in UTF-8, UTF-16 and UTF-32. If the given index is in the middle of a valid UTF-32 offset, the return value clips to the previous valid UTF-32 offset.</p><p>Accepts: The offset to find in. Can be UTF-8, UTF-16 or UTF-32. The Piece_rope.t to find the offset in.</p><p>Returns: The index_offsets record for the given offset and Piece_rope.t.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_matches"><a href="#val-find_matches" class="anchor"></a><code><span><span class="keyword">val</span> find_matches : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span> <span>int array</span></span></code></div><div class="spec-doc"><p>This function finds all matches of a given string in the given Piece_tree and returns an int array with the UTF-32 indices the string was found at. The array contains the matches are in order, where array.<code>0</code> is the first match. If no matches are found, returns an empty array.</p><p>Accepts: The string to find. The Piece_rope.t to find within.</p><p>Returns: An int array representing the indices in terms of UTF-32 offsets.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_and_replace"><a href="#val-find_and_replace" class="anchor"></a><code><span><span class="keyword">val</span> find_and_replace : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function finds all matches of one string and replaces them with another.</p><p>Accepts: The string to find. The string to replace with. The Piece_rope.t to replace within.</p><p>Returns: A Piece_rope.t with all instances of the string replaced.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-can_undo"><a href="#val-can_undo" class="anchor"></a><code><span><span class="keyword">val</span> can_undo : <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>This function returns true if there is anything in the undo stack of the given piece_rope. It is not necessary as calling undo when the undo stack is empty will result in a no-op.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-can_redo"><a href="#val-can_redo" class="anchor"></a><code><span><span class="keyword">val</span> can_redo : <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>This function returns true if there is anything in the redo stack of the given piece_rope. It is not necessary as calling redo when the redo stack is empty will result in a no-op.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-undo"><a href="#val-undo" class="anchor"></a><code><span><span class="keyword">val</span> undo : 
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function adds the current state of the piece_rope to the redo stack and pops the most recent state in the undo stack and makes it current. If the undo stack is empty, this will just result in a no-op.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-redo"><a href="#val-redo" class="anchor"></a><code><span><span class="keyword">val</span> redo : 
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function adds the current state of the piece_rope to the undo stack and pops the most recent state in the redo stack and makes it current. If the redo stack is empty, this will just result in a no-op.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-serialise"><a href="#val-serialise" class="anchor"></a><code><span><span class="keyword">val</span> serialise : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>This function serialises the given piece_rope to a file at the given string. This is useful for persisting the undo and redo stacks across sessions of your application. To achieve this functionality, all you need to do is to serialise a piece_rope with this function and then call deserialise with the created file path.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-deserialise"><a href="#val-deserialise" class="anchor"></a><code><span><span class="keyword">val</span> deserialise : <span>string <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function deserialises the file at the file path contained in the given string and returns the corresponding piece_rope, with the undo and redo stacks restored. It is paired with the serialise function as they must both be used together for persistent undo and redo.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_to_history"><a href="#val-add_to_history" class="anchor"></a><code><span><span class="keyword">val</span> add_to_history : 
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function sets a flag for the current state of the piece_rope to be added to the undo stack the next time one of these functions is called@</p><ul><li>Insert</li><li>Append</li><li>Prepend</li><li>Delete</li><li>Find and replace</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-count_string_stats"><a href="#val-count_string_stats" class="anchor"></a><code><span><span class="keyword">val</span> count_string_stats : <span>string <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Piece_rope__.Piece_types.string_stats</span></span></code></div><div class="spec-doc"><p>This function returns a record containing the given string's length in UTF-8, UTF-16 and UTF-32 and the number of line breaks where one line break can be \r \n or \r\n.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rebuild"><a href="#val-rebuild" class="anchor"></a><code><span><span class="keyword">val</span> rebuild : 
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function rebuilds the given piece_rope at the current state so that it performs as well as it did when it was first opened. The undo and redo stacks are preserved and rebuilt as well. Note that this function is unnecessary when your only operation is append as that is the optimal case for this data structure. It will spend time executing but give no benefit. Recommended to run this method asynchronously as it can be computationally expensive.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save"><a href="#val-save" class="anchor"></a><code><span><span class="keyword">val</span> save : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>This function just saves the given piece_rope to the file path in the provided string. It does not do any special processing, unlike serialise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-load"><a href="#val-load" class="anchor"></a><code><span><span class="keyword">val</span> load : <span>string <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span></span></code></div><div class="spec-doc"><p>This function loads the file at the given file path and returns a piece_rope. There is no special processing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_text"><a href="#val-fold_text" class="anchor"></a><code><span><span class="keyword">val</span> fold_text : 
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>This function executes a given function on every string in the Piece_rope.t.. It is an extensibility point you can use to implement your own functions, such as writing a file.</p><p>Accepts: The Piece_rope.t to fold in. The initial state to fold with. The function to apply at each stage.</p><p>Returns: The result of applying the given function on each string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_lines"><a href="#val-fold_lines" class="anchor"></a><code><span><span class="keyword">val</span> fold_lines : 
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Piece_rope__.Piece_types.line_offset</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>This function executes a given function on every line in the Piece_rope.t. It is an extensibility point you can use to implement your own functions.</p><p>Accepts: The Piece_rope.t to fold in. The initial state to fold with. The function to apply at each stage.</p><p>Returns: The result of applying the given function on each line.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_match_indices"><a href="#val-fold_match_indices" class="anchor"></a><code><span><span class="keyword">val</span> fold_match_indices : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Piece_rope__.Piece_types.piece_rope</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>This function executes a given function on every UTF-32 index matched with the given string in the Piece_rope.t. It is an extensibility point you can use to implement your own functions. Internally, the find_matches and find_and_replace functions rely on this.</p><p>Accepts: The Piece_rope.t to fold in. The initial state to fold with. The function to apply at each stage.</p><p>Returns: The result of applying the given function on each matched index.</p></div></div></div></body></html>